<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: url('my_bg.png') no-repeat center center;
      background-size: cover;
    }
    #joystick {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 120px;
      height: 120px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #fff;
      border-radius: 50%;
      touch-action: none;
    }
    #stick {
      position: absolute;
      left: 40px;
      top: 40px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      pointer-events: none;
    }
    #restartButton {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 24px;
      font-size: 18px;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10;
    }
  </style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js">
function saveHighscore() {
  const name = document.getElementById("playerName").value || "Безымянный";
  const newRef = db.ref("highscores").push();
  newRef.set({
    name: name,
    score: score,
    time: Date.now()
  });
  document.getElementById("nameEntry").style.display = "none";
  loadHighscores();
}

);

window.addEventListener('keyup', (e) => {
  switch (e.code) {
    case 'KeyW': case 'KeyS': case 'ArrowUp': case 'ArrowDown':
      velocity.y = 0; break;
    case 'KeyA': case 'KeyD': case 'ArrowLeft': case 'ArrowRight':
      velocity.x = 0; break;
  }
});

    
    
    loadHighscores();


function saveHighscore() {
  const name = document.getElementById("playerName").value || "Безымянный";
  const newRef = db.ref("highscores").push();
  newRef.set({
    name: name,
    score: score,
    time: Date.now()
  });
  document.getElementById("nameEntry").style.display = "none";
  loadHighscores();
}

function loadHighscores() {
  const list = document.getElementById("highscoreList");
  list.innerHTML = "";
  db.ref("highscores")
    .orderByChild("score")
    .limitToLast(5)
    .once("value")
    .then(snapshot => {
      const scores = [];
      snapshot.forEach(child => {
        scores.unshift(child.val());
      });
      scores.forEach(s => {
        const item = document.createElement("li");
        item.textContent = `${s.name}: ${s.score}`;
        list.appendChild(item);
      });
    });
}


function loadHighscores() {
  const list = document.getElementById("highscoreList");
  list.innerHTML = "";

  db.ref("highscores").once("value").then(snapshot => {
    const data = snapshot.val();
    const entries = [];

    for (let key in data) {
      const entry = data[key];
      entries.push(entry);
    }

    // Группируем по имени, оставляя лучший результат
    const grouped = {};
    entries.forEach(entry => {
      const name = entry.name;
      const score = entry.score;
      if (!grouped[name]) {
        grouped[name] = [];
      }
      grouped[name].push(score);
    });

    const uniqueEntries = [];
    for (let name in grouped) {
      const scores = grouped[name];
      const maxScore = Math.max(...scores);
      scores.forEach(s => {
        uniqueEntries.push({ name, score: s });
      });
    }

    // Сортировка по убыванию
    uniqueEntries.sort((a, b) => b.score - a.score);

    // Оставляем только топ 10
    const top10 = uniqueEntries.slice(0, 10);
    top10.forEach(entry => {
      const item = document.createElement("li");
      item.textContent = `${entry.name}: ${entry.score}`;
      list.appendChild(item);
    });
  });
}

</script>


  <div id="nameEntry" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:8px; z-index:20;">
    <label>Введите имя: <input id="playerName" type="text" /></label>
    <button onclick="saveHighscore()">Сохранить</button>
  </div>
  <div id="highscores" style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.2); color:white; padding:10px; font-size:14px;">
    <div><b>Топ рекордов:</b></div>
    <ul id="highscoreList" style="padding-left: 18px;"></ul>
  </div>

</body>
</html>
